---
type: rule
archivedreason: 
title: Do you know how to improve web page performance with lazy loading of media assets?
guid: 3b77adac-4387-4ba1-8ece-0e4a32e75458
uri: do-you-know-how-to-improve-web-page-performance-with-lazy-loading-of-media-assets
created: 2019-06-21T22:41:38.0000000Z
authors:
- title: William Yin
  url: https://ssw.com.au/people/william-yin
related: []
redirects: []

---


<p class="ssw15-rteElement-P">If you are dealing with Content Management System (CMS), you are likely to play with pages with large amount of images and embedded videos. To improve the performance of those pages, and save bandwidth for the readers, loading content asynchronously (also called “lazy loading”) is recommended. <br></p><div><p class="ssw15-rteElement-P">​It means the browsers will only load images and embedded videos in the visible area by default, then load the rest images and videos while users are scrolling down to them. <span style="color:#444444;">​</span></p></div>
<br><excerpt class='endintro'></excerpt><br>
<p>On our rules web site, one of the pages’ initial loading size of images reduced from 4.8MB to 500KB after being applied “lazy loading” of images:</p><dl class="badImage"><dt>
      <img src="load-images-1.jpg" alt="load-images-1.jpg" style="width:750px;height:231px;" />
   </dt><dd>Figure: Bad Example - load all images by default</dd></dl><dl class="goodImage"><dt>
         <img src="load-images-2.jpg" alt="load-images-2.jpg" style="width:750px;height:224px;" />
      </dt><dd>Figure: Good Example - Do not load all images by default, only load them when they are visible while scrolling down the browsers</dd></dl>The page's initial loading size of JS scripts reduced from 2.3MB to 518KB after being applied “lazy loading” of embedded YouTube videos:<dl class="badImage"><dt>
            <img src="load-images-3.jpg" alt="load-images-3.jpg" style="width:750px;height:374px;" />
         </dt><dd>Figure: Bad Example – load all embedded YouTube videos by default</dd></dl><dl class="goodImage"><dt>
            <img src="load-images-4.jpg" alt="load-images-4.jpg" style="width:750px;height:437px;" />
         </dt><dd>Figure: Good Example - Do not load all embedded YouTube videos by default, only load them when they are visible while scrolling down the browsers</dd></dl><p>​To implement lazy loading for image:</p><p>1.	Check if the browser supports IntersectionObserver, if the browser supports IntersectionObserver, we will only load images and videos in the areas are visible to users by default. If the browser doesn’t support it, we will have to load all images and embedded videos on the page immediately after the page is loaded.<br></p><p class="ssw15-rteElement-CodeArea">if (!('IntersectionObserver' in window)) {<br>    console.log("No Intersection");<br>} else {<br>               console.log("Support intersection");<br>}   </p><p> 
         <b>Note:</b> You can use a polyfill library to add <b>IntersectionObserver</b> support to older browsers.<br></p><p>2.	If the browser supports IntersectionObserver, in your page html, change the “src” of “<img>” to “data-src”<br>From</p><p class="ssw15-rteElement-CodeArea"><img alt="flight.jpg" 
         <span class="ssw15-rteStyle-Highlight">src</span>="https://rules.ssw.com.au/PublishingImages/flight.jpg"></p><p>to</p><p class="ssw15-rteElement-CodeArea"><img alt="flight.jpg" 
         <span class="ssw15-rteStyle-Highlight">data-src</span>="https://rules.ssw.com.au/PublishingImages/flight.jpg"></p><p> 
         <br>3.	Use the below Javascript to change “data-src” back to “src” for the <img> html objects, which become visible, so that those images will be loaded</p><p class="ssw15-rteElement-CodeArea">function onIntersection(entries) {<br>  // Loop through the entries<br>  entries.forEach(entry => {<br>    // Are we in viewport?<br>    if (entry.intersectionRatio > 0) {<br><br><br>      // Stop watching and load the image<br>      observer.unobserve(entry.target);<br>                 //console.log(entry);<br>                 //console.log(entry.target);          <br>      preloadImage(entry.target);<br>    }<br>  });<br>}<br>function preloadImage(target){<br>console.log(target);<br>if (target.getAttribute('<span class="ssw15-rteStyle-Highlight">data-src</span>')) {<br>            target.setAttribute('<span class="ssw15-rteStyle-Highlight">src</span>', target.getAttribute('data-src'));<br>        } <br>}<br><br>​// Get images of class lazy<br><br>const images = document.querySelectorAll('.sswRuleSummaryUCDiv img');<br>const config = {<br>  // If image gets within 50px go get it<br>  rootMargin: '50px 0px',<br>  threshold: 0.01<br>};<br><br>let observer = new IntersectionObserver(onIntersection, config);<br> <br>  images.forEach(image => {<br>    observer.observe(image);<br>  });<br><br></p><p> 
         <br>4.	More details can be found at 
         <a href="https://www.hanselman.com/blog/UpdatingJQuerybasedLazyImageLoadingToIntersectionObserver.aspx">https://www.hanselman.com/blog/UpdatingJQuerybasedLazyImageLoadingToIntersectionObserver.aspx​</a><br><br>To implement lazy loading for embedded YouTube videos:</p><p>1.	Use the same code as lazy loading images above, to check if IntersectionObserver is supported by browsers.<br>2.	In your page html code, convert “<iframe>” to “<div>” (width, height, src has been converted too):<br><br>From</p><p class="ssw15-rteElement-CodeArea"><iframe width="853" height="480" src="https://www.youtube.com/embed/OhVYTOKCsWI" frameborder="0"></iframe></p><p>To</p><p class="ssw15-rteElement-CodeArea"><!-- (1) video wrapper in div instead of iframe --><br><div data-iframewidth="853" data-iframeheight="480" data-iframecode="OhVYTOKCsWI" data-iframesrc="https://www.youtube.com/embed/OhVYTOKCsWI" frameborder="0"><br>    <!-- (2) the "play" button --><br>    <div class="play-button"></div>      <br></div><br></p><p> 
         <br>3. <b></b>Use the below code to convert “<div>” to “<iframe>” to load the embedded videos when they are visible while scrolling down:</p><p class="ssw15-rteElement-CodeArea">var youtube = document.querySelectorAll( "div[data-iframesrc]" );<br>          for (var i = 0; i < youtube.length; i++) {<br>        <br>        var source = "https://img.youtube.com/vi/"+ youtube[i].dataset.<span class="ssw15-rteStyle-Highlight">iframecode</span> +"/sddefault.jpg";<br>        <br>        var image = new Image();<br>                image.src = source;<br>                image.addEventListener( "load", function() {<br>                    youtube[ i ].appendChild( image );<br>                }( i ) );<br>        <br>                youtube[i].addEventListener( "click", function() {<br><br><br>                    var iframe = document.createElement( "iframe" );<br><br><br>                            iframe.setAttribute( "frameborder", "0" );<br>                            iframe.setAttribute( "allowfullscreen", "" );<br>                            iframe.setAttribute( "width", this.dataset.<span class="ssw15-rteStyle-Highlight">iframewidth</span> );<br>                            iframe.setAttribute( "height", this.dataset.<span class="ssw15-rteStyle-Highlight">iframeheight</span> );<br>                            iframe.setAttribute( "src", this.dataset.<span class="ssw15-rteStyle-Highlight">iframesrc</span> +"?rel=0&showinfo=0&autoplay=1" );<br>                            this.innerHTML = "";<br>                            this.appendChild( iframe );<br>                } );    <br>    };<br><br></p><p> 
         ​<br>4.	<b></b>More details can be found at 
         <a href="https://webdesign.tutsplus.com/tutorials/how-to-lazy-load-embedded-youtube-videos--cms-26743">https://webdesign.tutsplus.com/tutorials/how-to-lazy-load-embedded-youtube-videos--cms-26743 ​</a><br></p>



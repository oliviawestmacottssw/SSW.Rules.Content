---
type: rule
archivedreason: 
title: Do you know the Code Health (Quality Gates) to add?
guid: 316c617a-3636-4c40-85dc-c94fdc98fbfa
uri: do-you-know-the-code-health-quality-gates-to-add
created: 2017-02-20T22:26:58.0000000Z
authors:
- title: Adam Cogan
  url: https://ssw.com.au/people/adam-cogan
- title: Danijel Malik
  url: https://ssw.com.au/people/danijel-malik
related: []
redirects:
- do-you-know-the-code-health-(quality-gates)-to-add

---


​​​​Code health is all about quality and consistency. Here is how to use various auditors and linters not just in your development environment, but also on your VisualStudio.com build.<br>
<br><excerpt class='endintro'></excerpt><br>
<p>Depending on your development environment and the type of project, you should utilise different auditing tools.<br> 1) Visual Studio - How to install and modify Visual Studio Analysers<br> 2) Visual Studio Code - How to include TSLint and CSSLint extensions<br> 3) VisualStudio.com - How to produce a build script which analyses code as part of the build process​​<br></p><p>Following the steps should take about 15 minutes to do, but longer to implement depending on the size of your solution. (Requires solution analysis in VS and at least one build on VisualStudio.com)<br></p><p class="ssw15-rteElement-InfoBox">Version 1.2<br>- Added step to include "PrimaryBuild" variable as a pseudo id for the API<br>​Version 1.1<br>- Removed CssLint from VisualStudio.com build definition<br>- Added Web Essentials to Visual Studio environment​<br></p><h3 class="ssw15-rteElement-H3">Visual Studio<br></h3><p>Search & Install the NuGet packages:<br><span class="ssw15-rteStyle-IndentText">​"Roslyn Security Guard " <a href="https://www.nuget.org/packages/RoslynSecurityGuard/">https://www.nuget.org/packages/RoslynSecurityGuard/</a></span><br class="ssw15-rteStyle-IndentText"><span class="ssw15-rteStyle-IndentText">"StyleCop.Analysers" <a href="https://www.nuget.org/packages/StyleCop.Analyzers/1.0.0">https://www.nuget.org/packages/StyleCop.Analyzers/1.0.0</a></span><br class="ssw15-rteStyle-IndentText"><span class="ssw15-rteStyle-IndentText">"tslint" <a href="https://www.nuget.org/packages/tslint/">https://www.nuget.org/packages/tslint/</a></span><br><br>For Visual Studio development on web applications, download Web Essentials, it will provide intellisense for JS, CSS, HTML, Less, Scss, and CoffeeScript. (<a href="https://marketplace.visualstudio.com/items?itemName=MadsKristensen.WebEssentials20153">https://marketplace.visualstudio.com/items?itemName=MadsKristensen.WebEssentials20153​</a> )<br>​​<br></p><dl class="ssw15-rteElement-ImageArea"><img src="VS-InstallNuGetPackages.png" alt="VS-InstallNuGetPackages.png" style="margin:5px;width:808px;" /></dl><dd class="ssw15-rteElement-FigureNormal">Figure: Steps to install NuGet Packages<br></dd><p class="ssw15-rteElement-P">​Here is a quick guide to the steps to install NuGet Packages to the entire solution:<br> 1) Right click solution<br> 2) Select "Manage NuGet packages for solution"<br> 3) Select "Browse"<br> 4) Search &lt;package name&gt;<br> 5) Select &lt;package name&gt;<br> 6) Check all projects<br> 7) Click "Install"<br><br>Issues from these will now be returned in the Visual Studio analyser error list.<br></p><dl class="ssw15-rteElement-ImageArea"><img src="VS-RoslynRules.png" alt="VS-RoslynRules.png" style="margin:5px;" />​​​​<span style="color:#555555;font-size:0.9rem;font-weight:bold;">​</span><span style="color:#555555;font-size:0.9rem;font-weight:bold;">​Figure: New Roslyn Rule issues raised in Visual Studio Analyser</span></dl><p class="ssw15-rteElement-P"><br>Run Code Analysis on the project. Check over all of the warnings, if they are unnecessary or inappropriate, disable them, otherwise modify their severity level to "Error". <br>When the build is run, "Errors" will break the build, while "Warnings" will be reported, but not break the build.<br>Rules which have been flagged should also be checked once the build is completed<br></p><h3 class="ssw15-rteElement-H3">Modify Visual Studio Analysis<br></h3><p class="ssw15-rteElement-P">​​The goal is to develop a shared ruleset across projects. (Currently this is just the default settings)<br>Any project specific rules should be documented in "_Instructions-CodeHealth.docx" kept in the solution.<br><span class="ssw15-rteStyle-Highlight">Please also copy the current version number of this rule into the "_Instructions-CodeHealth.docx" in order to track what version your existing solution adheres to.</span><br>​<br></p><div><div class="ssw15-rteElement-ContentBlock-SSW-Only">The current standard for rules is just the default ones. Frequently check back here for updates to the ruleset definition.<br></div><dl class="ssw15-rteElement-ImageArea"><dl class="ssw15-rteElement-ImageArea">​​​​<img src="VS-ModifyRules.png" alt="VS-ModifyRules.png" style="margin:5px;width:808px;" /></dl><dd class="ssw15-rteElement-FigureNormal">​​​Figure: Steps to open Visual Studio Analyser rules customisation page<br></dd><p class="ssw15-rteElement-P">​Right Click project | Properties | Code Analysis |​ Open<br></p></dl><dl class="ssw15-rteElement-ImageArea"><dl class="ssw15-rteElement-ImageArea"><img src="VS-ModifyRules2.png" alt="VS-ModifyRules2.png" style="margin:5px;width:808px;" /><dd class="ssw15-rteElement-FigureNormal">​​Figure: How to customize rules. By either enabling / disabling rules or packages. Or by modifying the rule severity level.<br></dd></dl></dl><h3 class="ssw15-rteElement-H3">Visual Studio Code<br></h3><p>​For web projects, we advocate the use of CSSLint for css files and TSLint for typescript files. (<a href=/do-you-know-when-to-use-typescript-vs-javascript-and-coffeescript>Why you should be using TypeScript instead of JavaScript​</a>)<br></p><p>Linters for these can be easily added to VS Code via extensions.<br>Simply select the "Extensions" tab, search for "CSSLint" and "TSLint" and click "Install" on each respectively.​<br></p><dl class="ssw15-rteElement-ImageArea">​<img src="VSCode-Extensions.png" alt="VSCode-Extensions.png" style="margin:5px;width:808px;" /></dl><dd class="ssw15-rteElement-FigureNormal">Figure: Addition of CssLint and TSLint to VS Code Project<br></dd><p>If you prefer not to use the Extensions (which are currently a bit out of date). You can install them using npm as normal.​​<br></p><p>CssLint <a href="https://www.npmjs.com/package/csslint">https://www.npmjs.com/package/csslint​</a><br>TSLint <a href="https://www.npmjs.com/package/tslint">https://www.npmjs.com/package/tslint</a>​<br></p><h3 class="ssw15-rteElement-H3">​Automatically Check your Build in VisualStudio.com<br></h3><p><span class="ssw15-rteStyle-Highlight">Ensure utilisation of TeamBuild2015 or higher. (No support for XAML builds)</span><br>Edit the build definition​<br></p><dl class="ssw15-rteElement-ImageArea"><img src="VSO-EditBuild.png" alt="VSO-EditBuild.png" style="margin:5px;width:808px;" /></dl><dd class="ssw15-rteElement-FigureNormal">Figure: Steps to edit an existing build definition on VisualStudio.com ​​</dd><p>Select "Build & Release" &gt; Select "Builds" &gt; Click on your existing build &gt; Click "Edit"<br></p><dl><dl class="ssw15-rteElement-ImageArea"><dl class="ssw15-rteElement-ImageArea">​<img src="VSO-BuildDefinition-V3.png" alt="VSO-BuildDefinition-V3.png" style="margin:5px;width:808px;" /></dl><span style="color:#555555;font-size:0.9rem;font-weight:bold;background-color:initial;">​​Figure: Example completed build definition.</span></dl></dl><dl><dl class="ssw15-rteElement-ImageArea"><dl class="ssw15-rteElement-ImageArea"><img src="VSO-DirectoryExampleV2.png" alt="VSO-DirectoryExampleV2.png" style="margin:5px;width:808px;" /></dl></dl></dl><dd class="ssw15-rteElement-FigureNormal">​Figure: Example directory for TSLint run commands<br></dd><p>Under advanced for the Command Line tasks, the Working Directory can be specified if necessary.</p><p><span class="ssw15-rteStyle-Caption">TsLint​</span></p><p><strong>Npm </strong>- Install tslint and typescript<br><span class="ssw15-rteStyle-IndentText"><strong>Name​: </strong>npm install tslint<br></span>​​​<strong class="ssw15-rteStyle-IndentText">Working Folder:</strong> &lt;Top Directory&gt;<br class="ssw15-rteStyle-IndentText"><span class="ssw15-rteStyle-IndentText"><strong>Npm Command:</strong> install</span><br class="ssw15-rteStyle-IndentText"><span class="ssw15-rteStyle-IndentText"><strong>Arguments:</strong> -g tslint typescript</span></p><p class="ssw15-rteElement-P"><strong>Command Line</strong> - Check the version ​​​(Useful to determine rule discrepancies across builds)<br><span class="ssw15-rteStyle-IndentText"><strong>Name​</strong>: Check tslint version</span><br class="ssw15-rteStyle-IndentText"><span class="ssw15-rteStyle-IndentText"><strong>Tool: </strong>tslint</span><br class="ssw15-rteStyle-IndentText"><span class="ssw15-rteStyle-IndentText"><strong>Arguments:</strong> -v</span></p><p><strong>Command Line</strong> - Builds a default configuration file for the build (Without it issues can differ between build and development environment<br><span class="ssw15-rteStyle-IndentText"><strong>Name​: </strong>Create tslint config file</span><br class="ssw15-rteStyle-IndentText"><span class="ssw15-rteStyle-IndentText"><strong>Tool: </strong>tslint</span><br class="ssw15-rteStyle-IndentText"><span class="ssw15-rteStyle-IndentText"><strong>Arguments: </strong>--init</span></p><p><strong>Command Line</strong> - Run tslint, force is required to stop the build from crashing (TSLint will return and exit code of 1 regardless of if issues exist)<br><span class="ssw15-rteStyle-IndentText"><strong>Name​: ​</strong>Run tslint</span><br class="ssw15-rteStyle-IndentText"><span class="ssw15-rteStyle-IndentText"><strong>Tool:​ </strong>TSLint</span><br class="ssw15-rteStyle-IndentText"><span class="ssw15-rteStyle-IndentText"><strong>Arguments: </strong>--force &lt;Solution Directory&gt;/**/*.ts{,x}</span></p><p class="ssw15-rteElement-P">If your build is being hosted, then the config file must be reloaded every time. If your build is running on premises, the config file will attempt to load over the existing one and break the build.<br>If this is the case, just add a step to delete your config file after the scan is complete.<br></p><dl class="ssw15-rteElement-ImageArea"><img src="VSO-RemoveConfig.png" alt="VSO-RemoveConfig.png" style="margin:5px;width:808px;" /><dd class="ssw15-rteElement-FigureNormal">​Figure: Command line step to remove the config file (tslint.json) after the linter has run<br></dd></dl><p class="ssw15-rteElement-P">​<strong>Command Line</strong> - Remove the tslint config file, as it will break future scan if the build is on premises if a config file already exists and an attempt to add another one is made.<br><strong>​​<span class="ssw15-rteStyle-IndentText">​</span>Name​: </strong>​Remove tslint config<br><strong>​<span class="ssw15-rteStyle-IndentText"></span>Tool:​ </strong>del<br><strong>​<span class="ssw15-rteStyle-IndentText"></span>Arguments:</strong> tslint.json​<br><br></p><p>Once complete, save the build definition and run the build.​<br>Then check the build is successful.<br>If the build fails (due to errors), these should be corrected in the development environment. <br>If warnings exist, the rule should be disabled or set as an error. (If it is worth fixing, then it should be required for everyone)<br></p><div class="ssw15-rteElement-ContentBlock-SSW-Only">​​​​At the moment, it is fine to leave the warnings in the build, since the defined standard of rules is not set</div><p>​<span style="color:#555555;font-size:0.9rem;font-weight:bold;background-color:initial;">​​</span></p><p class="ssw15-rteElement-P">If your project does not contain TypeScript files, then you do not need to include the TSLint build tasks.</p><dl><dd class="ssw15-rteElement-FigureNormal"><img src="VSO-EnsureTSLintRuns.png" alt="VSO-EnsureTSLintRuns.png" style="margin:5px;width:808px;" />​​Figure: Ensure TSLint actually finds files to scan (if the project includes TSLint files) otherwise it will pass without you noticing<br></dd><p class="ssw15-rteElement-P"><br></p><p class="ssw15-rteElement-P">​For the purposes of reporting, a unique tag must be added to the build definition which the Code Health steps have been applied to. ​<br>This is done with the addition of a variable (Name = PrimaryBuild, Value = true)<span style="background-color:initial;">​</span></p><dl class="ssw15-rteElement-ImageArea"><dd class="ssw15-rteElement-FigureNormal"><img src="VSO-AddVariableTag.png" alt="VSO-AddVariableTag.png" style="margin:5px;width:650px;" />Figure: Steps to add PrimaryBuild variable to build definition​​<span style="background-color:initial;color:#333333;font-size:13px;">​​​​​​​​​​</span></dd></dl></dl><dl class="ssw15-rteElement-ImageArea"><dl class="ssw15-rteElement-ImageArea"><img src="VSO-BuildResult-BadV3.png" alt="VSO-BuildResult-BadV3.png" style="margin:5px;width:808px;" /></dl></dl><dd class="ssw15-rteElement-FigureBad">​​​Figu​re: Bad Example - Build broke due to compile errors. Must fix to proceed.​<br></dd><dl><dl><dl class="ssw15-rteElement-ImageArea">​​<img src="VSO-BuildResultV3.png" alt="VSO-BuildResultV3.png" style="margin:5px;width:808px;" /></dl><dd class="ssw15-rteElement-FigureBad">​​​​​​​​​​​Figure: Bad Example - Successful build with warnings. Should be disabled or set as errors.​​<br></dd></dl><dl class="ssw15-rteElement-ImageArea"><dl class="ssw15-rteElement-ImageArea">​​​​​​<img src="VSO-BuildResult-GoodV3.png" alt="VSO-BuildResult-GoodV3.png" style="margin:5px;width:808px;" /></dl></dl><dd class="ssw15-rteElement-FigureGood">​​​​​​​​​​Figure: Good Example - Successful build with no warnings.<br></dd></dl><p><br><br></p></div>


